---
# tasks file for nginx
- name: "Ensure that nginx is installed."
  yum: 
    name:
      - nginx
    state: present
  when: ansible_facts['os_family'] == "RedHat"

- name: "Ensure that nginx is installed."
  apt: 
    name:
      - nginx
    state: present
  when: ansible_facts['os_family']  == "Ubuntu"
  notify:
    - "Restart nginx"

- name: "Add Index page."
  template:
    src: "index.html.j2"
    dest: "/usr/share/nginx/html/index.html"
    owner: root
    group: root
    mode: 0755

# - name: "Restart nginx"
#   service:
#     name: nginx
#     state: restarted
#     enabled: yes

- name: "Wait for port {{ port }} to become open on the host, don't start checking for 10 seconds"
  wait_for:
    port: "{{ port }}"
    delay: 10

- name: "Show current ip"
  debug:
    msg: "http://{{ ansible_facts.all_ipv4_addresses[0] }}:{{ port }}"